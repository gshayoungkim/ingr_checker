<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingredient Checker - Korea</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” Ingredient Checker</h1>
            <p>Check ingredients in Korean food products</p>
        </header>

        <div class="input-guide-section">
            <p>'í’ˆëª©ë³´ê³ ë²ˆí˜¸' ë˜ëŠ” 'ë°”ì½”ë“œë²ˆí˜¸'ë¥¼ ë„£ì–´ì£¼ì„¸ìš”</p>
            <p>Please input 'í’ˆëª©ë³´ê³ ë²ˆí˜¸(Product Report Number)' or 'Barcode Number'</p>
        </div>

        <div class="search-section">
    <input type="text" id="searchInput" placeholder="Enter product number or barcode" autocomplete="off">
    <button id="searchBtn" onclick="searchProduct()">Search</button>
    <button id="helpBtn" onclick="openGuideModal()" title="How to find product number or barcode">
        â“ Guide
    </button>
</div>

<!-- ê°€ì´ë“œ íŒì—… ëª¨ë‹¬ -->
<div id="guideModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeGuideModal()"></div>
    <div class="modal-content guide-content">
        <button class="modal-close" onclick="closeGuideModal()">Ã—</button>
        <h2>ğŸ“ How to Find Product Number or Barcode</h2>
        
        <div class="guide-section">
            <h3>ğŸ”¹ Product Report Number (í’ˆëª©ë³´ê³ ë²ˆí˜¸)</h3>
            <p>Location: Usually on the back or side of the package</p>
            <img src="/static/guide-imrpt.png" alt="Product Report Number Location" style="max-width: 100%; margin: 15px 0; border-radius: 10px;">
        </div>
        
        <div class="guide-section">
            <h3>ğŸ”¹ Barcode Number (ë°”ì½”ë“œë²ˆí˜¸)</h3>
            <p>Location: Usually at the bottom of the package</p>
            <img src="/static/guide-barcode.png" alt="Barcode Location" style="max-width: 100%; margin: 15px 0; border-radius: 10px;">
        </div>
        
        <div class="guide-tips">
            <p><strong>ğŸ’¡ Tips:</strong></p>
            <ul>
                <li>Product Report Number: 12-15 digits, usually starts with date</li>
                <li>Barcode: 13 digits, shows as bars + numbers</li>
                <li>You only need ONE of them to search</li>
            </ul>
        </div>
    </div>
</div>


        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Searching...</p>
        </div>

        <div id="errorMessage" class="error-message hidden"></div>

        <div id="results" class="results hidden">
            <div class="product-info">
                <h2>Product Information</h2>
                <p class="product-name" id="productName"></p>
                <p class="product-source" id="productSource"></p>
            </div>
            <div class="ingredients-section">
                <h3>âš ï¸ Detected Ingredients</h3>
                <div id="ingredientsList" class="ingredients-list"></div>
                <p id="noIngredientsMessage" class="no-ingredients hidden">
                    âœ… None of the common allergens or restricted ingredients were detected.
                </p>
            </div>
            <div class="raw-materials">
                <h3>ğŸ“‹ Full Ingredient List (Korean)</h3>
                <p id="rawMaterials" class="raw-materials-text"></p>
            </div>
        </div>

        <div class="disclaimer-section">
            <h3>âš ï¸ Important Notice</h3>
            <div class="disclaimer-item">
                <h4>ğŸ” For Reference Only</h4>
                <p><strong>ì°¸ê³ ìš©ì´ë¯€ë¡œ ì‹¤ì œ ì œí’ˆ í¬ì¥ì§€ì™€ ë¹„êµí•´ë³´ì„¸ìš”.</strong><br>For reference only. Please compare with the actual product packaging.</p>
            </div>
            <div class="disclaimer-item">
                <h4>âš¡ Limited Ingredient Detection</h4>
                <p><strong>ì™¸êµ­ì¸Â·ë¹„ê±´Â·ì¢…êµÂ·ì•ŒëŸ¬ì§€ ë“± ì£¼ì˜ê°€ í•„ìš”í•œ ì›ì¬ë£Œë§Œ í‘œì‹œí•©ë‹ˆë‹¤.</strong><br>Only ingredients requiring caution for foreigners, vegans, religious restrictions, and allergies are listed.</p>
            </div>
            <div class="disclaimer-item">
                <h4>ğŸ“Š Database Limitations</h4>
                <p><strong>ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì–´ ìˆì§€ ì•Šì€ í•­ëª©ì€ ë‚˜ì˜¤ì§€ ì•Šì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</strong><br>Some items may not appear if they are not stored in the database.</p>
            </div>
            <p class="disclaimer-footer">Always verify with the product packaging before consumption, especially if you have allergies or dietary restrictions.</p>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const results = document.getElementById('results');

        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') searchProduct();
        });

        async function searchProduct() {
            const searchValue = searchInput.value.trim();
            if (!searchValue) {
                showError('Please enter a product number or barcode');
                return;
            }
            hideError();
            hideResults();
            showLoading();

            try {
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ searchValue })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'Search failed');
                displayResults(data);
            } catch (error) {
                showError(error.message);
            } finally {
                hideLoading();
            }
        }
        function openGuideModal() {
            document.getElementById('guideModal').classList.remove('hidden');
        }

        function closeGuideModal() {
            document.getElementById('guideModal').classList.add('hidden');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('guideModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal || e.target.classList.contains('modal-overlay')) {
                        closeGuideModal();
                    }
                });
            }
        });

        // ESC í‚¤ë¡œ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeGuideModal();
            }
});


        function displayResults(data) {
            document.getElementById('productName').textContent = data.productName;
            const sourceElement = document.getElementById('productSource');
            sourceElement.textContent = data.source || '';
            sourceElement.style.display = data.source ? 'block' : 'none';

            const ingredientsList = document.getElementById('ingredientsList');
            const noIngredientsMessage = document.getElementById('noIngredientsMessage');
            ingredientsList.innerHTML = '';

            const foundIngredients = data.foundIngredients || {};
            if (Object.keys(foundIngredients).length > 0) {
                noIngredientsMessage.classList.add('hidden');
                for (const [category, info] of Object.entries(foundIngredients)) {
                    const card = document.createElement('div');
                    card.className = 'ingredient-card';
                    card.innerHTML = `
                        <span class="ingredient-icon">âš ï¸</span>
                        <div class="ingredient-info">
                            <div class="ingredient-english">${info.english}</div>
                            <div class="ingredient-korean">${category}</div>
                            <div class="ingredient-detected">${info.detected.join(', ')}</div>
                        </div>
                    `;
                    ingredientsList.appendChild(card);
                }
            } else {
                noIngredientsMessage.classList.remove('hidden');
            }

            if (data.rawMaterials) {
                document.getElementById('rawMaterials').textContent = data.rawMaterials;
            }
            showResults();
        }

        function showLoading() { loading.classList.remove('hidden'); }
        function hideLoading() { loading.classList.add('hidden'); }
        function showError(message) { errorMessage.textContent = message; errorMessage.classList.remove('hidden'); }
        function hideError() { errorMessage.classList.add('hidden'); }
        function showResults() { results.classList.remove('hidden'); }
        function hideResults() { results.classList.add('hidden'); }
    </script>
</body>
</html>
